<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫</title>
</head>
<body>
  <h1>–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫</h1>
  <button onclick="startRecognition()">üé§ –ì–æ–≤–æ—Ä–∏—Ç—å</button>
  <p id="userText">–í—ã: ...</p>
  <p id="assistantText">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: ...</p>

  <script>
    const synth = window.speechSynthesis;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ru-RU';
    recognition.interimResults = false;

    let stage = -1;
    let userName = "";
    let mood = "—Ö–æ—Ä–æ—à–æ";
    let waitingForSupport = false;

    function speak(text) {
      document.getElementById("assistantText").textContent = "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: " + text;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ru-RU';
      synth.speak(utter);
    }

    function startRecognition() {
      recognition.start();
    }

    recognition.onresult = function(event) {
      const input = event.results[0][0].transcript;
      document.getElementById("userText").textContent = "–í—ã: " + input;
      handleInput(input.toLowerCase());
    };

    function handleInput(input) {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç "–ø—Ä–∞–≤–∏–ª–∞"
      if (input.includes("–ø—Ä–∞–≤–∏–ª–∞") || input.includes("–∫–∞–∫ –∏–≥—Ä–∞—Ç—å")) {
        speak("–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –∏–≥—Ä–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–º –∏–≥—Ä–æ–≤–æ–º —Å—Ç–æ–ª–µ ‚Äî —ç—Ç–æ –≤–µ—Å–µ–ª–æ –∏ –ø–æ–º–æ–∂–µ—Ç —Ç–≤–æ–∏–º —Ä—É—á–∫–∞–º! –ù–∞–∂–º–∏ '–°—Ç–∞—Ä—Ç', —à–∞—Ä–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è, –∞ —è ‚Äî —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ ‚Äî —Å–∫–∞–∂—É '–î–∞–≤–∞–π!'. –ù–∞–∫–ª–æ–Ω—è–π –¥–∂–æ–π—Å—Ç–∏–∫, —á—Ç–æ–±—ã –∫–ª—é—à–∫–∞ —É–¥–∞—Ä–∏–ª–∞ —à–∞—Ä–∏–∫ –≤ –ª—É–Ω–∫—É, –∏ —Å—Ç–∞—Ä–∞–π—Å—è –ø–æ–ø–∞—Å—Ç—å! –ï—Å–ª–∏ –ø–æ–ø–∞–ª ‚Äî —É–≤–∏–¥–∏—à—å –∑–µ–ª–µ–Ω–æ–≥–æ —Å–º–∞–π–ª–∏–∫–∞, —É—Å–ª—ã—à–∏—à—å '–±–∏–ø!' –∏ –ø–æ–ª—É—á–∏—à—å –æ—á–∫–æ, —à–∞—Ä–∏–∫ –≤–µ—Ä–Ω–µ—Ç—Å—è. –ï—Å–ª–∏ –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è ‚Äî —à–∞—Ä–∏–∫ –≤–µ—Ä–Ω–µ—Ç—Å—è —Å–∞–º, –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞. –°–ª–µ–¥–∏ –∑–∞ —Å—á—ë—Ç –Ω–∞ —Ç–∞–±–ª–æ, –∞ –ª—É–Ω–∫–∏ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –º–µ—Å—Ç–æ ‚Äî —ç—Ç–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ! –ù–µ –±–æ–π—Å—è, —è –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º. –ù–∞–∂–º–∏ '–°—Ç–∞—Ä—Ç' –∏ –∏–≥—Ä–∞–π!");
        return;
      }

      // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –≥–æ–≤–æ—Ä–∏—Ç "—Å—Ç–∞—Ä—Ç" ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π
      if (input.includes("—Å—Ç–∞—Ä—Ç") && stage === -1) {
        stage = 0;
        speak("–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞? –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?");
        return;
      }

      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ "–ø–ª–æ—Ö–æ"
      if (waitingForSupport) {
        speak("–ì—Ä—É—Å—Ç–Ω–æ, –Ω–æ –Ω–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è ‚Äî –≤—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ, –∏ —è —Ç–µ–±—è –ø–æ–¥–¥–µ—Ä–∂—É.");
        waitingForSupport = false;
        stage = 3;
        return;
      }

      switch (stage) {
        case 0:
          if (input.includes("–ø–ª–æ—Ö–æ")) {
            mood = "–ø–ª–æ—Ö–æ";
          }

          const nameMatch = input.match(/–º–µ–Ω—è –∑–æ–≤—É—Ç\s+([–∞-—è–ê-–Øa-zA-Z]+)/i);
          userName = nameMatch ? nameMatch[1] : "–¥—Ä—É–≥";

          if (mood === "–ø–ª–æ—Ö–æ") {
            speak(`–ü–æ—á–µ–º—É, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å, ${userName}?`);
            waitingForSupport = true;
          } else {
            speak(`–û—Ç–ª–∏—á–Ω–æ! –°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç, ${userName}?`);
            stage = 2;
          }
          break;

        case 2:
          const ageMatch = input.match(/\d+/);
          if (ageMatch) {
            speak(`–ö—Ä—É—Ç–æ! –¢–µ–±–µ ${ageMatch[0]} –ª–µ—Ç!`);
          } else {
            speak("–ö—Ä—É—Ç–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–≤–µ—Ç.");
          }
          stage = 3;
          break;

        case 3:
          speak("–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–∂–µ—à—å —Å–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–±–æ–ª—Ç–∞—Ç—å —Å–æ –º–Ω–æ–π!");
          break;

        default:
          speak("–Ø —Ç–µ–±—è —Å–ª—É—à–∞—é!");
          break;
      }
    }

    recognition.onerror = function(event) {
      speak("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: " + event.error);
    };
  </script>
</body>
</html>
